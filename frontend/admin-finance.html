<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>財務審核 - 小跑豬後台</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/admin-modern.css" />
  </head>
  <body>
    <div class="container-fluid">
      <h1 class="page-title">財務管理與審核</h1>

      <div class="card">
        <div class="card-body">
          <div class="filters-bar" style="margin-bottom: 0">
            <div style="flex: 1; min-width: 200px">
              <input
                type="text"
                id="search-input"
                class="form-control"
                placeholder="搜尋會員姓名或 Email..."
              />
            </div>
            <div style="flex: 0 0 150px">
              <select id="status-filter" class="form-control">
                <option value="PENDING">待審核 (PENDING)</option>
                <option value="COMPLETED">已完成 (COMPLETED)</option>
                <option value="REJECTED">已駁回 (REJECTED)</option>
                <option value="">所有狀態</option>
              </select>
            </div>
            <div style="flex: 0 0 150px">
              <select id="type-filter" class="form-control">
                <option value="">所有類型</option>
                <option value="DEPOSIT">儲值 (Deposit)</option>
                <option value="PAYMENT">扣款 (Payment)</option>
                <option value="ADJUST">人工調整 (Adjust)</option>
              </select>
            </div>
            <button class="btn btn-primary" id="btn-search">
              <i class="fas fa-search"></i> 查詢
            </button>
            <button class="btn btn-warning" id="btn-manual-adjust">
              <i class="fas fa-coins"></i> 手動調整餘額
            </button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <span><i class="fas fa-file-invoice-dollar"></i> 交易紀錄列表</span>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="modern-table">
              <thead>
                <tr>
                  <th>時間</th>
                  <th>會員</th>
                  <th>類型</th>
                  <th>金額</th>
                  <th>說明 / 憑證</th>
                  <th>狀態</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="transaction-list">
                <tr>
                  <td colspan="7" class="text-center p-3">載入中...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div
          class="card-body border-top"
          id="pagination"
          style="display: flex; justify-content: flex-end; gap: 5px"
        ></div>
      </div>
    </div>

    <div
      id="proof-modal"
      class="modal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      "
    >
      <div class="card" style="max-width: 500px; width: 90%">
        <div class="card-header">
          <span>匯款憑證</span>
          <button class="btn btn-sm btn-danger modal-close-btn">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="card-body text-center">
          <img
            id="proof-img-display"
            src=""
            style="
              max-width: 100%;
              max-height: 60vh;
              border: 1px solid #ccc;
              margin-bottom: 15px;
            "
          />
          <div
            id="review-actions"
            style="display: flex; gap: 10px; justify-content: center"
          >
            <button class="btn btn-success" id="btn-approve">
              通過審核 (加值)
            </button>
            <button class="btn btn-danger" id="btn-reject">駁回申請</button>
          </div>
        </div>
      </div>
    </div>

    <div
      id="adjust-modal"
      class="modal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      "
    >
      <div class="card" style="width: 500px; max-width: 90%">
        <div class="card-header">
          <span>人工調整餘額</span>
          <button class="btn btn-sm btn-danger modal-close-btn">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="card-body">
          <form id="adjust-form">
            <div class="form-group mb-3">
              <label>搜尋會員 (Email/姓名)</label>
              <div style="position: relative">
                <input
                  type="text"
                  id="adjust-search-user"
                  class="form-control"
                  autocomplete="off"
                  required
                  placeholder="輸入關鍵字..."
                />
                <div
                  id="user-search-results"
                  style="
                    display: none;
                    position: absolute;
                    top: 100%;
                    left: 0;
                    width: 100%;
                    background: white;
                    border: 1px solid #ddd;
                    z-index: 10;
                    max-height: 150px;
                    overflow-y: auto;
                  "
                ></div>
              </div>
              <input type="hidden" id="adjust-user-id" />
            </div>
            <div class="form-group mb-3">
              <label>調整金額 (NT$)</label>
              <input
                type="number"
                id="adjust-amount"
                class="form-control"
                required
                placeholder="正數為加款，負數為扣款"
              />
              <small class="text-danger"
                >注意：輸入 1000 代表增加 $1000；輸入 -500 代表扣除
                $500。</small
              >
            </div>
            <div class="form-group mb-3">
              <label>備註說明</label>
              <input
                type="text"
                id="adjust-note"
                class="form-control"
                required
                placeholder="例如：退還運費差額"
              />
            </div>
            <button type="submit" class="btn btn-primary w-100">
              確認調整
            </button>
          </form>
        </div>
      </div>
    </div>

    <script src="js/apiConfig.js"></script>
    <script src="js/admin-layout.js"></script>
    <script src="js/admin-finance.js"></script>
  </body>
</html>
