<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>會員管理 - 管理後台</title>
    <link rel="icon" href="assets/logo.png" type="image/png" />
    <link rel="stylesheet" href="css/style.css?v=2" />
  </head>
  <body>
    <div class="container" style="max-width: 1400px">
      <img src="assets/logo.png" alt="小跑豬 LOGO" class="header-logo" />

      <div class="admin-header">
        <h1>會員管理</h1>
        <div class="header-actions">
          <a href="admin-dashboard.html" class="btn btn-secondary">儀表板</a>
          <a
            href="admin-register.html"
            class="btn btn-secondary"
            style="background-color: #2ecc71"
            id="btn-nav-create-staff"
            >新增員工帳號</a
          >
          <a href="admin-parcels.html" class="btn btn-secondary">包裹管理</a>
          <a href="admin-shipments.html" class="btn btn-secondary"
            >集運單管理</a
          >
          <a
            href="admin-members.html"
            class="btn btn-secondary active"
            id="btn-nav-members"
            >會員管理</a
          >
          <a href="admin-logs.html" class="btn btn-secondary" id="btn-nav-logs"
            >操作日誌</a
          >

          <span id="admin-welcome"></span>
          <button id="logoutBtn" class="btn-danger">登出</button>
        </div>
      </div>

      <div id="admin-only-content">
        <div class="stats-container">
          <div class="stat-card total">
            <h3>總使用者數</h3>
            <p class="number" id="stats-total">0</p>
          </div>
          <div class="stat-card active">
            <h3>啟用中</h3>
            <p class="number" id="stats-active">0</p>
          </div>
          <div class="stat-card inactive">
            <h3>已停用</h3>
            <p class="number" id="stats-inactive">0</p>
          </div>
        </div>

        <div class="filters-container">
          <div class="filters">
            <input
              type="text"
              id="search-input"
              placeholder="搜尋姓名、Email、電話..."
            />
            <select id="filter-status">
              <option value="">所有狀態</option>
              <option value="true">啟用中</option>
              <option value="false">已停用</option>
            </select>
            <select id="filter-role">
              <option value="">所有角色</option>
              <option value="USER">會員 (USER)</option>
              <option value="ADMIN">管理員 (ADMIN)</option>
              <option value="OPERATOR">操作員 (OPERATOR)</option>
            </select>
            <button class="btn btn-primary" id="filter-btn">搜尋</button>
          </div>
        </div>

        <div class="members-table-container">
          <table class="members-table">
            <thead>
              <tr>
                <th>姓名</th>
                <th>Email</th>
                <th>電話</th>
                <th>角色</th>
                <th>註冊日期</th>
                <th>狀態</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="membersTableBody">
              <tr>
                <td colspan="7" class="loading">
                  <div class="spinner"></div>
                  <p>載入使用者資料中...</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div
      id="edit-permissions-modal"
      class="modal-overlay"
      style="display: none"
    >
      <div class="modal-content">
        <button class="modal-close-btn">&times;</button>
        <h2>編輯權限</h2>
        <p>
          正在編輯:
          <strong id="edit-perms-email" style="color: #1a73e8">...</strong>
        </p>

        <div
          id="edit-perms-message-box"
          class="alert"
          style="display: none"
        ></div>

        <form id="edit-permissions-form">
          <input type="hidden" id="edit-perms-userId" />

          <div class="form-group">
            <label class="required">帳號權限</label>
            <fieldset
              id="edit-perms-fieldset"
              style="border: 1px solid #ccc; padding: 10px; border-radius: 5px"
            >
              <div style="margin-bottom: 5px">
                <input
                  type="checkbox"
                  id="edit-perm-CAN_VIEW_DASHBOARD"
                  value="CAN_VIEW_DASHBOARD"
                />
                <label for="edit-perm-CAN_VIEW_DASHBOARD">查看儀表板</label>
              </div>
              <div style="margin-bottom: 5px">
                <input
                  type="checkbox"
                  id="edit-perm-CAN_MANAGE_PACKAGES"
                  value="CAN_MANAGE_PACKAGES"
                />
                <label for="edit-perm-CAN_MANAGE_PACKAGES"
                  >管理包裹 (入庫/更新)</label
                >
              </div>
              <div style="margin-bottom: 5px">
                <input
                  type="checkbox"
                  id="edit-perm-CAN_MANAGE_SHIPMENTS"
                  value="CAN_MANAGE_SHIPMENTS"
                />
                <label for="edit-perm-CAN_MANAGE_SHIPMENTS"
                  >管理集運單 (出貨/退回)</label
                >
              </div>

              <hr style="margin: 10px 0" />

              <div style="margin-bottom: 5px">
                <input
                  type="checkbox"
                  id="edit-perm-CAN_MANAGE_USERS"
                  value="CAN_MANAGE_USERS"
                />
                <label
                  for="edit-perm-CAN_MANAGE_USERS"
                  style="color: #d32f2f; font-weight: bold"
                  >[A] 管理會員/員工 (高權限)</label
                >
              </div>
              <div style="margin-bottom: 5px">
                <input
                  type="checkbox"
                  id="edit-perm-CAN_VIEW_LOGS"
                  value="CAN_VIEW_LOGS"
                />
                <label
                  for="edit-perm-CAN_VIEW_LOGS"
                  style="color: #d32f2f; font-weight: bold"
                  >[A] 查看操作日誌 (高權限)</label
                >
              </div>
              <div style="margin-bottom: 5px">
                <input
                  type="checkbox"
                  id="edit-perm-CAN_IMPERSONATE_USERS"
                  value="CAN_IMPERSONATE_USERS"
                />
                <label
                  for="edit-perm-CAN_IMPERSONATE_USERS"
                  style="color: #d32f2f; font-weight: bold"
                  >[A] 模擬客戶登入 (高權限)</label
                >
              </div>
            </fieldset>
          </div>

          <button type="submit" class="btn btn-primary">儲存權限</button>
        </form>
      </div>
    </div>
    <script src="js/apiConfig.js"></script>
    <script src="js/admin-members.js"></script>
  </body>
</html>
