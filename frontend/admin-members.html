<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>會員管理 - 管理後台</title>
    <link rel="icon" href="assets/logo.png" type="image/png" />
    <script src="js/styleLoader.js"></script>
  </head>
  <body>
    <div class="container" style="max-width: 1400px">
      <img src="assets/logo.png" alt="小跑豬 LOGO" class="header-logo" />

      <div id="admin-header-container" data-title="儀表板"></div>

      <div id="admin-only-content">
        <div class="stats-container">
          <div class="stat-card total">
            <h3>總使用者數</h3>
            <p class="number" id="stats-total">0</p>
          </div>
          <div class="stat-card active">
            <h3>啟用中</h3>
            <p class="number" id="stats-active">0</p>
          </div>
          <div class="stat-card inactive">
            <h3>已停用</h3>
            <p class="number" id="stats-inactive">0</p>
          </div>
        </div>

        <div class="filters-container">
          <div class="filters">
            <input
              type="text"
              id="search-input"
              placeholder="搜尋姓名、Email、電話..."
            />
            <select id="filter-status">
              <option value="">所有狀態</option>
              <option value="true">啟用中</option>
              <option value="false">已停用</option>
            </select>
            <select id="filter-role">
              <option value="">所有角色</option>
              <option value="USER">會員 (USER)</option>
              <option value="ADMIN">管理員 (ADMIN)</option>
              <option value="OPERATOR">操作員 (OPERATOR)</option>
            </select>
            <button class="btn btn-primary" id="filter-btn">搜尋</button>
          </div>
        </div>

        <div class="members-table-container">
          <div class="admin-table-wrapper">
            <table class="members-table">
              <thead>
                <tr>
                  <th>姓名</th>
                  <th>Email</th>
                  <th>電話</th>
                  <th>角色</th>
                  <th>註冊日期</th>
                  <th>狀態</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="membersTableBody">
                <tr>
                  <td
                    colspan="7"
                    style="text-align: center; padding: 30px; color: #999"
                  >
                    載入使用者資料中...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div id="pagination" class="pagination-container"></div>
        </div>
      </div>
    </div>

    <div
      id="edit-permissions-modal"
      class="modal-overlay"
      style="display: none"
    >
      <div class="modal-content">
        <button class="modal-close-btn">&times;</button>
        <h2>編輯權限</h2>
        <p>
          正在編輯:
          <strong id="edit-perms-email" style="color: #1a73e8">...</strong>
        </p>

        <div
          id="edit-perms-message-box"
          class="alert"
          style="display: none"
        ></div>

        <form id="edit-permissions-form">
          <input type="hidden" id="edit-perms-userId" />

          <div class="form-group">
            <label class="required">帳號權限</label>
            <fieldset
              id="edit-perms-fieldset"
              style="border: 1px solid #ccc; padding: 10px; border-radius: 5px"
            >
              <div style="margin-bottom: 5px">
                <input
                  type="checkbox"
                  id="edit-perm-CAN_VIEW_DASHBOARD"
                  value="CAN_VIEW_DASHBOARD"
                />
                <label for="edit-perm-CAN_VIEW_DASHBOARD">查看儀表板</label>
              </div>
              <div style="margin-bottom: 5px">
                <input
                  type="checkbox"
                  id="edit-perm-CAN_MANAGE_PACKAGES"
                  value="CAN_MANAGE_PACKAGES"
                />
                <label for="edit-perm-CAN_MANAGE_PACKAGES"
                  >管理包裹 (入庫/更新)</label
                >
              </div>
              <div style="margin-bottom: 5px">
                <input
                  type="checkbox"
                  id="edit-perm-CAN_MANAGE_SHIPMENTS"
                  value="CAN_MANAGE_SHIPMENTS"
                />
                <label for="edit-perm-CAN_MANAGE_SHIPMENTS"
                  >管理集運單 (出貨/退回)</label
                >
              </div>

              <hr style="margin: 10px 0" />

              <div style="margin-bottom: 5px">
                <input
                  type="checkbox"
                  id="edit-perm-CAN_MANAGE_USERS"
                  value="CAN_MANAGE_USERS"
                />
                <label
                  for="edit-perm-CAN_MANAGE_USERS"
                  style="color: #d32f2f; font-weight: bold"
                  >[A] 管理會員/員工 (高權限)</label
                >
              </div>
              <div style="margin-bottom: 5px">
                <input
                  type="checkbox"
                  id="edit-perm-CAN_VIEW_LOGS"
                  value="CAN_VIEW_LOGS"
                />
                <label
                  for="edit-perm-CAN_VIEW_LOGS"
                  style="color: #d32f2f; font-weight: bold"
                  >[A] 查看操作日誌 (高權限)</label
                >
              </div>
              <div style="margin-bottom: 5px">
                <input
                  type="checkbox"
                  id="edit-perm-CAN_IMPERSONATE_USERS"
                  value="CAN_IMPERSONATE_USERS"
                />
                <label
                  for="edit-perm-CAN_IMPERSONATE_USERS"
                  style="color: #d32f2f; font-weight: bold"
                  >[A] 模擬客戶登入 (高權限)</label
                >
              </div>
            </fieldset>
          </div>

          <button type="submit" class="btn btn-primary">儲存權限</button>
        </form>
      </div>
    </div>

    <div id="admin-edit-user-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close-btn">&times;</button>
        <h2>編輯會員資料</h2>
        <form id="admin-edit-user-form">
          <input type="hidden" id="admin-edit-user-id" />
          <div class="form-group">
            <label>Email (不可修改)</label>
            <input
              type="text"
              id="admin-edit-user-email"
              class="form-control"
              disabled
              style="background: #f0f0f0"
            />
          </div>
          <div class="form-group">
            <label>姓名</label>
            <input type="text" id="admin-edit-user-name" class="form-control" />
          </div>
          <div class="form-group">
            <label>電話</label>
            <input
              type="text"
              id="admin-edit-user-phone"
              class="form-control"
            />
          </div>
          <div class="form-group">
            <label>預設地址</label>
            <textarea
              id="admin-edit-user-address"
              class="form-control"
              rows="2"
            ></textarea>
          </div>
          <button type="submit" class="btn btn-primary">儲存變更</button>
        </form>
      </div>
    </div>

    <div id="delete-user-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close-btn">&times;</button>
        <h2 style="color: #d32f2f">⚠️ 永久刪除警告</h2>
        <p style="line-height: 1.6">
          您即將刪除會員：<strong id="delete-target-email"></strong><br />
          此操作將<strong>同時刪除</strong>該會員的所有：
        </p>
        <ul style="color: #555; margin-bottom: 15px">
          <li>包裹紀錄</li>
          <li>集運單紀錄</li>
          <li>操作日誌</li>
        </ul>
        <p style="color: #d32f2f; font-weight: bold">此動作無法復原！</p>

        <div class="form-group" style="margin-top: 20px">
          <label>請輸入該會員的完整 Email 以確認刪除：</label>
          <input
            type="text"
            id="delete-confirmation-input"
            class="form-control"
            placeholder="在此輸入 Email"
            onpaste="return false;"
          />
        </div>

        <div style="display: flex; gap: 10px; margin-top: 20px">
          <button
            class="btn btn-secondary modal-close-btn"
            style="background-color: #95a5a6"
          >
            取消
          </button>
          <button
            id="btn-confirm-delete"
            class="btn btn-danger"
            disabled
            style="opacity: 0.5"
          >
            確認永久刪除
          </button>
        </div>
      </div>
    </div>

    <script src="js/apiConfig.js"></script>
    <script src="js/admin-members.js"></script>
  </body>
</html>
