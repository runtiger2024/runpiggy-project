<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>會員中心 | 我的集運</title>
    <link rel="icon" href="assets/logo.png" type="image/png" />
    <script src="js/styleLoader.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* 圖片預覽容器樣式 */
      .preview-container {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 10px;
      }
      .preview-container img {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 4px;
        border: 1px solid #ddd;
      }

      /* 用戶資料卡的小按鈕專用樣式 */
      .btn-mini {
        padding: 4px 12px;
        font-size: 12px;
        height: 32px;
        line-height: 1;
        width: auto !important;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
      }
    </style>
  </head>
  <body class="dashboard-theme">
    <div class="container dashboard-container">
      <header class="dashboard-header">
        <div class="header-left">
          <img src="assets/logo.png" alt="Logo" class="header-logo-sm" />
          <h1>會員中心</h1>
        </div>

        <div
          class="header-right-actions"
          style="display: flex; align-items: center; gap: 15px"
        >
          <div class="notification-wrapper" style="position: relative">
            <div
              id="btn-notification"
              style="
                cursor: pointer;
                font-size: 20px;
                color: #555;
                padding: 5px;
              "
            >
              <i class="fas fa-bell"></i>
              <span
                id="notification-badge"
                class="notification-badge"
                style="display: none"
                >0</span
              >
            </div>
            <div
              id="notification-dropdown"
              class="notification-dropdown"
              style="display: none"
            >
              <div class="dropdown-header">
                <span>通知中心</span>
                <button id="btn-read-all" class="btn-text">全部已讀</button>
              </div>
              <div id="notification-list" class="dropdown-body">
                <div
                  class="empty-state"
                  style="padding: 20px; text-align: center; color: #999"
                >
                  載入中...
                </div>
              </div>
            </div>
          </div>

          <nav class="main-nav header-nav-right"></nav>
        </div>
      </header>

      <div id="message-box" class="alert" style="display: none"></div>

      <div class="user-profile-card">
        <div class="profile-bg"></div>
        <div class="profile-content">
          <div class="avatar-circle">
            <i class="fas fa-user"></i>
          </div>
          <div class="profile-details">
            <h2 id="welcome-message">歡迎回來</h2>
            <div class="user-meta">
              <span class="meta-item"
                ><i class="fas fa-envelope"></i>
                <span id="user-email">...</span></span
              >
              <span class="meta-item"
                ><i class="fas fa-phone"></i>
                <span id="user-phone">...</span></span
              >
            </div>
            <div class="user-address">
              <i class="fas fa-map-marker-alt"></i>
              <span id="user-address">...</span>
            </div>
          </div>
          <div class="profile-actions">
            <button
              id="btn-edit-profile"
              class="btn btn-secondary btn-mini btn-edit-profile"
            >
              <i class="fas fa-pen"></i> 編輯
            </button>
            <button
              id="btn-change-password"
              class="btn btn-outline-primary btn-mini"
              style="background: #fff"
            >
              <i class="fas fa-key"></i> 修改密碼
            </button>
          </div>
        </div>
      </div>

      <div
        id="draft-queue-container"
        class="notice-card warning"
        style="display: none"
      >
        <div
          class="notice-content"
          style="
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
          "
        >
          <h4 style="margin-top: 0; color: #856404">
            <i class="fas fa-clock"></i> 待處理的試算包裹
          </h4>
          <p style="margin: 5px 0">您有從試算表帶入的商品，將依序自動填入：</p>
          <ul id="draft-queue-list" style="margin: 0; padding-left: 20px"></ul>
        </div>
      </div>

      <div class="section-card forecast-section">
        <div class="card-header">
          <h3><i class="fas fa-box-open"></i> 預報新包裹</h3>
        </div>
        <div class="card-body">
          <div
            id="forecast-warning-box"
            class="alert alert-error"
            style="display: none; margin-bottom: 15px; font-weight: bold"
          ></div>

          <div
            class="alert alert-warning"
            style="
              display: block;
              font-size: 13px;
              background-color: #fff3cd;
              color: #856404;
              border: 1px solid #ffeeba;
              margin-bottom: 15px;
            "
          >
            <i class="fas fa-exclamation-triangle"></i>
            <strong>重要提醒：</strong>
            若您的單件包裹重量超過
            100kg，請務必確認台灣收件端可<strong>自行安排堆高機</strong>卸貨。
          </div>

          <form id="forecast-form" class="forecast-form-grid">
            <div class="form-group">
              <label class="required">物流單號</label>
              <input
                type="text"
                id="trackingNumber"
                class="form-control"
                placeholder="掃描或輸入單號"
                required
              />
            </div>
            <div class="form-group">
              <label class="required">商品名稱</label>
              <input
                type="text"
                id="productName"
                class="form-control"
                placeholder="例：書桌"
                required
              />
            </div>
            <div class="form-group short">
              <label>數量</label>
              <input
                type="number"
                id="quantity"
                class="form-control"
                value="1"
                min="1"
              />
            </div>
            <div class="form-group short">
              <label>照片 (報關用)</label>
              <input
                type="file"
                id="images"
                multiple
                accept="image/*"
                style="display: none"
              />
              <div
                id="forecast-uploader"
                class="image-uploader-container"
              ></div>
            </div>
            <div class="form-group full">
              <label>備註</label>
              <input
                type="text"
                id="note"
                class="form-control"
                placeholder="特殊需求..."
              />
            </div>
            <div class="form-group full" style="text-align: right">
              <button type="submit" class="btn btn-primary btn-add-cart">
                <i class="fas fa-plus-circle"></i> 提交預報
              </button>
            </div>
          </form>
        </div>
      </div>

      <div class="dashboard-tabs">
        <button id="tab-packages" class="tab-btn active">
          <i class="fas fa-boxes"></i> 我的包裹
        </button>
        <button id="tab-shipments" class="tab-btn">
          <i class="fas fa-shipping-fast"></i> 我的集運單
        </button>
        <button id="tab-recipients" class="tab-btn">
          <i class="fas fa-address-book"></i> 常用收件人
        </button>
      </div>

      <div id="packages-section" class="tab-content active">
        <div class="table-responsive cart-style">
          <table>
            <thead>
              <tr>
                <th width="40">選</th>
                <th>狀態</th>
                <th>商品/單號</th>
                <th>規格/費用</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="packages-table-body">
              <tr>
                <td colspan="5" class="text-center" style="padding: 30px">
                  載入中...
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="sticky-checkout-bar">
          <div class="checkout-info">
            已選 <span id="selected-pkg-count" class="highlight">0</span> 件
          </div>
          <button
            id="btn-create-shipment"
            class="btn btn-primary btn-checkout"
            disabled
          >
            合併打包
          </button>
        </div>
        <div style="height: 80px"></div>
      </div>

      <div id="shipments-section" class="tab-content" style="display: none">
        <div class="table-responsive order-style">
          <table>
            <thead>
              <tr>
                <th>訂單號</th>
                <th>狀態</th>
                <th>收件人/詳情</th>
                <th>總金額</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="shipments-table-body">
              <tr>
                <td colspan="5" class="text-center" style="padding: 30px">
                  載入中...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div style="height: 80px"></div>
      </div>

      <div id="recipient-section" class="tab-content" style="display: none">
        <div
          style="display: flex; justify-content: flex-end; margin-bottom: 15px"
        >
          <button
            id="btn-add-recipient"
            class="btn btn-primary btn-sm"
            style="width: auto"
          >
            <i class="fas fa-plus"></i> 新增收件人
          </button>
        </div>
        <div id="recipient-list-container" class="recipient-grid">
          <p
            class="text-center"
            style="width: 100%; color: #999; padding: 20px"
          >
            載入中...
          </p>
        </div>
        <div style="height: 80px"></div>
      </div>

      <nav class="mobile-bottom-nav" id="mobile-bottom-nav"></nav>
    </div>

    <div id="edit-profile-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <h3>編輯個人資料</h3>
        <form id="edit-profile-form">
          <div class="form-group">
            <label>姓名</label
            ><input type="text" id="edit-name" class="form-control" />
          </div>
          <div class="form-group">
            <label>電話</label
            ><input type="tel" id="edit-phone" class="form-control" />
          </div>
          <div class="form-group">
            <label>預設地址</label
            ><input type="text" id="edit-address" class="form-control" />
          </div>
          <button type="submit" class="btn btn-primary">儲存</button>
        </form>
      </div>
    </div>

    <div id="change-password-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <h3>🔒 修改登入密碼</h3>
        <form id="change-password-form">
          <div class="form-group">
            <label class="required">目前密碼</label>
            <input
              type="password"
              id="cp-current"
              class="form-control"
              required
              autocomplete="current-password"
            />
          </div>
          <div class="form-group">
            <label class="required">新密碼 (至少 6 位數)</label>
            <input
              type="password"
              id="cp-new"
              class="form-control"
              minlength="6"
              required
              autocomplete="new-password"
            />
          </div>
          <div class="form-group">
            <label class="required">確認新密碼</label>
            <input
              type="password"
              id="cp-confirm"
              class="form-control"
              minlength="6"
              required
              autocomplete="new-password"
            />
          </div>
          <button type="submit" class="btn btn-primary">確認修改</button>
        </form>
      </div>
    </div>

    <div id="edit-package-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <h3>編輯包裹</h3>
        <input type="hidden" id="edit-package-id" />
        <form id="edit-package-form">
          <div class="form-group">
            <label class="required">物流單號</label
            ><input
              type="text"
              id="edit-trackingNumber"
              class="form-control"
              required
            />
          </div>
          <div class="form-group">
            <label class="required">商品名稱</label
            ><input
              type="text"
              id="edit-productName"
              class="form-control"
              required
            />
          </div>
          <div class="form-group">
            <label>數量</label
            ><input
              type="number"
              id="edit-quantity"
              class="form-control"
              min="1"
            />
          </div>
          <div class="form-group">
            <label>備註</label
            ><input type="text" id="edit-note" class="form-control" />
          </div>
          <div class="form-group">
            <label>現有照片 (點擊紅色 X 可刪除):</label>
            <div
              id="edit-package-images-container"
              class="preview-container"
            ></div>
          </div>
          <div class="form-group">
            <label style="color: #1a73e8"
              ><i class="fas fa-plus"></i> 補傳新照片</label
            >
            <input
              type="file"
              id="edit-package-new-images"
              multiple
              accept="image/*"
              style="display: none"
            />
            <div
              id="edit-package-uploader"
              class="image-uploader-container"
            ></div>
          </div>
          <button type="submit" class="btn btn-primary">儲存變更</button>
        </form>
      </div>
    </div>

    <div id="create-shipment-modal" class="modal-overlay" style="display: none">
      <div class="modal-content modal-lg checkout-modal">
        <button class="modal-close">&times;</button>
        <div
          class="modal-header"
          style="
            border-bottom: 1px solid #eee;
            margin-bottom: 15px;
            padding-bottom: 10px;
          "
        >
          <h3>確認訂單 (合併打包)</h3>
        </div>
        <form id="create-shipment-form">
          <div class="checkout-layout">
            <div class="checkout-items">
              <h4 style="margin-top: 0">📦 包裹清單</h4>
              <div
                id="shipment-package-list"
                style="max-height: 200px; overflow-y: auto; margin-bottom: 10px"
              ></div>
              <div
                class="checkout-summary"
                style="border-top: 2px solid #ddd; padding-top: 15px"
              >
                <div id="api-fee-breakdown">
                  <div style="text-align: center; color: #999">
                    <div
                      class="spinner"
                      style="width: 20px; height: 20px; display: inline-block"
                    ></div>
                    正在雲端精算運費...
                  </div>
                </div>
              </div>
            </div>

            <div class="checkout-info-form">
              <div
                id="forklift-warning"
                class="alert alert-danger"
                style="display: none; margin-bottom: 15px"
              >
                <i class="fas fa-dolly"></i>
                <strong>超重提醒：</strong> 偵測到包裹含有超重物品 (單件 >
                100kg)。<br />
                請確認台灣收件地址可<strong>自行安排堆高機</strong>下貨，否則司機可能無法派送。
              </div>

              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                "
              >
                <h4>📝 收件資訊</h4>
                <button
                  type="button"
                  id="btn-select-recipient"
                  class="btn btn-sm btn-outline-primary"
                  style="width: auto; padding: 4px 10px"
                >
                  <i class="fas fa-address-book"></i> 從常用選取
                </button>
              </div>

              <div class="form-group">
                <label class="required">收件人</label
                ><input
                  type="text"
                  id="ship-name"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label class="required">電話</label
                ><input
                  type="tel"
                  id="ship-phone"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label class="required">配送地區</label>
                <div style="display: flex; gap: 5px; margin-bottom: 5px">
                  <input
                    type="text"
                    id="ship-area-search"
                    placeholder="搜尋地區..."
                    class="form-control"
                    style="flex: 1"
                  />
                  <div id="ship-search-results" class="search-dropdown"></div>
                </div>
                <select
                  id="ship-delivery-location"
                  class="form-control"
                  required
                >
                  <option value="" selected disabled>--- 載入中 ---</option>
                </select>
                <div
                  id="ship-remote-area-info"
                  style="
                    display: none;
                    background: #e8f5e9;
                    padding: 5px;
                    margin-top: 5px;
                    border-radius: 4px;
                    font-size: 13px;
                  "
                >
                  選定：<span id="ship-selected-area-name"></span> (<span
                    id="ship-selected-area-fee"
                    style="color: #d32f2f; font-weight: bold"
                  ></span
                  >)
                </div>
              </div>
              <div class="form-group">
                <label class="required">詳細地址</label
                ><input
                  type="text"
                  id="ship-street-address"
                  class="form-control"
                  placeholder="路/街/號/樓"
                  required
                />
              </div>
              <div class="form-group">
                <label class="required">身分證 (報關用)</label
                ><input
                  type="text"
                  id="ship-idNumber"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label>統編/抬頭 (選填)</label>
                <div style="display: flex; gap: 10px">
                  <input
                    type="text"
                    id="ship-taxId"
                    class="form-control"
                    placeholder="統編"
                  />
                  <input
                    type="text"
                    id="ship-invoiceTitle"
                    class="form-control"
                    placeholder="抬頭"
                  />
                </div>
              </div>

              <div
                class="form-section"
                style="
                  margin-top: 20px;
                  border-top: 1px dashed #ccc;
                  padding-top: 15px;
                "
              >
                <h4 style="margin-bottom: 15px; color: #2c3e50">🛠️ 附加服務</h4>
                <div class="service-item" style="margin-bottom: 10px">
                  <div style="display: flex; align-items: center; gap: 10px">
                    <input
                      type="checkbox"
                      id="srv-floor"
                      style="width: 18px; height: 18px"
                    />
                    <label for="srv-floor" style="font-weight: bold; margin: 0"
                      >需要上樓搬運</label
                    >
                  </div>
                  <div
                    id="srv-floor-options"
                    style="
                      display: none;
                      margin-left: 28px;
                      margin-top: 8px;
                      padding: 10px;
                      background: #f8f9fa;
                      border-radius: 5px;
                    "
                  >
                    <div style="margin-bottom: 8px">
                      <label
                        style="
                          font-size: 13px;
                          display: block;
                          margin-bottom: 3px;
                        "
                        >電梯設施：</label
                      >
                      <div style="display: flex; gap: 15px">
                        <label style="font-weight: normal; font-size: 14px"
                          ><input
                            type="radio"
                            name="srv-elevator"
                            value="yes"
                          />
                          有電梯</label
                        >
                        <label style="font-weight: normal; font-size: 14px"
                          ><input type="radio" name="srv-elevator" value="no" />
                          無電梯 (需爬梯)</label
                        >
                      </div>
                    </div>
                    <input
                      type="text"
                      id="srv-floor-note"
                      class="form-control"
                      placeholder="備註 (例: 5樓, 樓梯較窄)..."
                      style="font-size: 13px"
                    />
                  </div>
                </div>
                <div class="service-item" style="margin-bottom: 10px">
                  <div style="display: flex; align-items: center; gap: 10px">
                    <input
                      type="checkbox"
                      id="srv-wood"
                      style="width: 18px; height: 18px"
                    />
                    <label for="srv-wood" style="font-weight: bold; margin: 0"
                      >回收木架</label
                    >
                  </div>
                  <div
                    id="srv-wood-input"
                    style="display: none; margin-left: 28px; margin-top: 5px"
                  >
                    <input
                      type="text"
                      id="srv-wood-note"
                      class="form-control"
                      placeholder="數量/備註..."
                      style="font-size: 13px"
                    />
                  </div>
                </div>
                <div class="service-item" style="margin-bottom: 10px">
                  <div style="display: flex; align-items: center; gap: 10px">
                    <input
                      type="checkbox"
                      id="srv-assembly"
                      style="width: 18px; height: 18px"
                    />
                    <label
                      for="srv-assembly"
                      style="font-weight: bold; margin: 0"
                      >傢俱組裝</label
                    >
                  </div>
                  <div
                    id="srv-assembly-input"
                    style="display: none; margin-left: 28px; margin-top: 5px"
                  >
                    <input
                      type="text"
                      id="srv-assembly-note"
                      class="form-control"
                      placeholder="備註..."
                      style="font-size: 13px"
                    />
                  </div>
                </div>
                <div class="service-item" style="margin-bottom: 10px">
                  <div style="display: flex; align-items: center; gap: 10px">
                    <input
                      type="checkbox"
                      id="srv-old"
                      style="width: 18px; height: 18px"
                    />
                    <label for="srv-old" style="font-weight: bold; margin: 0"
                      >回收舊傢俱</label
                    >
                  </div>
                  <div
                    id="srv-old-input"
                    style="display: none; margin-left: 28px; margin-top: 5px"
                  >
                    <input
                      type="text"
                      id="srv-old-note"
                      class="form-control"
                      placeholder="品項/數量 (例: 雙人床墊x1)..."
                      style="font-size: 13px"
                    />
                  </div>
                </div>
                <div
                  class="alert alert-warning"
                  style="
                    display: block;
                    margin-top: 15px;
                    background-color: #fff3cd;
                    color: #856404;
                    border: 1px solid #ffeeba;
                    font-size: 13px;
                    line-height: 1.6;
                  "
                >
                  <strong
                    ><i class="fas fa-exclamation-triangle"></i>
                    費用說明：</strong
                  ><br />
                  因每個社區中庭距離及規定不同，以上需求僅供司機參考。<br />
                  <span style="color: #d32f2f; font-weight: bold"
                    >實際報價以派送司機視現場情況為準，現場請務必與派送司機確認金額！</span
                  ><br />
                  此附加費用由客戶直接支付給派貨司機。<br />
                  (附加服務非我司收取，僅提供協助聯繫)
                </div>
              </div>

              <div
                class="proof-section"
                style="
                  margin-top: 20px;
                  border-top: 1px dashed #ccc;
                  padding-top: 15px;
                "
              >
                <label style="color: #e67e22; font-weight: bold"
                  >🛒 商品證明 (必填其一)</label
                >
                <p style="font-size: 12px; color: #666; margin: 5px 0">
                  購買連結或上傳截圖。
                </p>
                <textarea
                  id="ship-product-url"
                  class="form-control"
                  rows="2"
                  placeholder="連結..."
                  style="margin-bottom: 10px"
                ></textarea>
                <div
                  style="
                    text-align: center;
                    font-size: 12px;
                    color: #999;
                    margin-bottom: 10px;
                  "
                >
                  —— 或 ——
                </div>
                <input
                  type="file"
                  id="ship-product-images"
                  multiple
                  accept="image/*"
                  style="display: none"
                />
                <div
                  id="ship-shipment-uploader"
                  class="image-uploader-container"
                ></div>
              </div>
              <div class="form-group" style="margin-top: 15px">
                <label>備註</label
                ><input type="text" id="ship-note" class="form-control" />
              </div>
            </div>
          </div>

          <div class="modal-footer sticky-footer-actions">
            <button type="button" class="btn btn-secondary modal-close-btn">
              取消
            </button>
            <button type="submit" class="btn btn-primary btn-place-order">
              提交訂單
            </button>
          </div>
        </form>
      </div>
    </div>

    <div id="recipient-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <h3 id="recipient-modal-title">新增常用收件人</h3>
        <form id="recipient-form">
          <input type="hidden" id="recipient-id" />
          <div class="form-group">
            <label class="required">姓名</label>
            <input type="text" id="rec-name" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="required">電話</label>
            <input type="tel" id="rec-phone" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="required">身分證字號 (報關用)</label>
            <input
              type="text"
              id="rec-idNumber"
              class="form-control"
              required
            />
          </div>
          <div class="form-group">
            <label class="required">詳細地址</label>
            <input type="text" id="rec-address" class="form-control" required />
          </div>
          <div class="form-group">
            <label>
              <input type="checkbox" id="rec-isDefault" /> 設為預設收件人
            </label>
          </div>
          <button type="submit" class="btn btn-primary">儲存</button>
        </form>
      </div>
    </div>

    <div
      id="recipient-selector-modal"
      class="modal-overlay"
      style="display: none; z-index: 1100"
    >
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <h3>選擇常用收件人</h3>
        <div
          id="recipient-selector-list"
          class="recipient-selector-list"
          style="max-height: 300px; overflow-y: auto"
        ></div>
      </div>
    </div>

    <div id="bank-info-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <h3 style="text-align: center; color: #28a745">
          <i class="fas fa-check-circle"></i> 訂單建立成功！
        </h3>
        <div
          class="bank-details"
          style="
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
          "
        >
          <p>請匯款至：</p>
          <div class="bank-row">
            <strong>銀行：</strong><span id="bank-name">第一銀行 (007)</span>
          </div>
          <div class="bank-row">
            <strong>帳號：</strong
            ><span id="bank-account" style="color: #d32f2f; font-weight: bold"
              >60110066477</span
            >
          </div>
          <div class="bank-row">
            <strong>戶名：</strong><span id="bank-holder">跑得快國際貿易</span>
          </div>
          <button
            id="btn-copy-bank-info"
            class="btn btn-secondary btn-sm"
            style="width: 100%; margin-top: 10px"
          >
            複製資訊
          </button>
        </div>
        <div
          class="modal-footer"
          style="text-align: center; margin-top: 20px; display: flex; gap: 10px"
        >
          <button class="btn btn-secondary modal-close-btn" style="flex: 1">
            稍後上傳
          </button>
          <button
            id="btn-upload-now"
            class="btn btn-primary"
            style="flex: 1; background-color: #e67e22; border-color: #e67e22"
          >
            <i class="fas fa-camera"></i> 立即上傳憑證
          </button>
        </div>
      </div>
    </div>

    <div id="upload-proof-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <h3>上傳付款憑證</h3>
        <div
          id="upload-proof-bank-info"
          style="
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px dashed #ccc;
            font-size: 14px;
            line-height: 1.6;
          "
        >
          <p style="margin: 0; color: #666; text-align: center">
            載入匯款資訊中...
          </p>
        </div>
        <input type="hidden" id="upload-proof-id" />
        <form id="upload-proof-form">
          <div class="form-group">
            <input
              type="file"
              id="proof-file"
              accept="image/*"
              class="form-control"
              required
            />
          </div>
          <button type="submit" class="btn btn-primary">上傳</button>
        </form>
      </div>
    </div>

    <div id="package-details-modal" class="modal-overlay" style="display: none">
      <div class="modal-content modal-lg">
        <button class="modal-close">&times;</button>
        <h3>包裹入庫詳情</h3>
        <div id="details-boxes-list" style="margin-bottom: 15px"></div>
        <div
          class="detail-total-row"
          style="text-align: right; font-weight: bold"
        >
          <span>總重：<span id="details-total-weight"></span> kg</span>
          <span style="margin-left: 15px"
            >運費：<span id="details-total-fee" style="color: #d32f2f"></span
          ></span>
        </div>
        <hr />
        <h4>倉庫實拍</h4>
        <div
          id="details-images-gallery"
          style="
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
          "
        ></div>
        <button
          class="btn btn-secondary modal-close-btn"
          style="margin-top: 15px; width: 100%"
        >
          關閉
        </button>
      </div>
    </div>

    <div
      id="shipment-details-modal"
      class="modal-overlay"
      style="display: none"
    >
      <div class="modal-content modal-lg">
        <button class="modal-close">&times;</button>
        <h3>訂單詳情</h3>
        <div
          class="modal-body"
          style="max-height: 70vh; overflow-y: auto; padding: 10px"
        >
          <div class="modal-section-title">📝 訂單資訊</div>
          <div class="info-grid-responsive">
            <div><strong>訂單編號:</strong> <span id="sd-id"></span></div>
            <div><strong>狀態:</strong> <span id="sd-status"></span></div>
            <div><strong>建立日期:</strong> <span id="sd-date"></span></div>
            <div>
              <strong>台灣單號:</strong>
              <span
                id="sd-trackingTW"
                style="color: #1a73e8; font-weight: bold"
              ></span>
            </div>
          </div>
          <div class="modal-section-title">👤 收件人</div>
          <div style="background: #f9f9f9; padding: 10px; border-radius: 5px">
            <p style="margin: 5px 0">
              <strong>姓名:</strong> <span id="sd-name"></span>
            </p>
            <p style="margin: 5px 0">
              <strong>電話:</strong> <span id="sd-phone"></span>
            </p>
            <p style="margin: 5px 0">
              <strong>地址:</strong> <span id="sd-address"></span>
            </p>
          </div>
          <div class="modal-section-title">💰 費用明細</div>
          <div
            id="sd-fee-breakdown"
            style="
              background: #fff3e0;
              padding: 10px;
              border-radius: 5px;
              color: #e65100;
            "
          ></div>
          <div class="modal-section-title">🛒 購買證明</div>
          <div id="sd-proof-images" class="gallery-grid"></div>
        </div>
        <div class="modal-footer sticky-footer-actions">
          <button class="btn btn-primary modal-close-btn">關閉</button>
        </div>
      </div>
    </div>

    <div id="view-images-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <h3>照片瀏覽</h3>
        <div
          id="images-gallery"
          style="
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
          "
        ></div>
      </div>
    </div>

    <script src="js/libs/xlsx.full.min.js"></script>
    <script src="js/apiConfig.js"></script>
    <script src="js/shippingData.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/dashboard-core.js"></script>
    <script src="js/dashboard-packages.js"></script>
    <script src="js/dashboard-shipments.js"></script>
    <script src="js/dashboard-recipient.js"></script>
    <script src="js/dashboard-main.js"></script>
  </body>
</html>
