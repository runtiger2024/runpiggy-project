<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>會員中心 - 小跑豬</title>
    <link rel="icon" href="assets/logo.png" type="image/png" />
    <link rel="stylesheet" href="css/style.css?v=2" />
  </head>
  <body>
    <div class="container">
      <img src="assets/logo.png" alt="小跑豬 LOGO" class="header-logo" />
      <h1>會員中心</h1>

      <nav class="main-nav"></nav>

      <div id="message-box" class="alert" style="display: none"></div>

      <div class="user-info-box">
        <h2 id="welcome-message">歡迎回來，...</h2>
        <div class="info-grid">
          <p><strong>Email:</strong> <span id="user-email">-</span></p>
          <p><strong>電話:</strong> <span id="user-phone">-</span></p>
          <p><strong>預設地址:</strong> <span id="user-address">-</span></p>
        </div>
        <div class="action-buttons">
          <button id="btn-edit-profile" class="btn btn-secondary">
            編輯資料
          </button>
        </div>
      </div>

      <div
        id="draft-queue-container"
        class="form-section"
        style="
          display: none;
          background-color: #fff3cd;
          border-color: #ffeeba;
          margin-bottom: 15px;
        "
      >
        <h4 style="color: #856404; margin-top: 0">⏳ 待處理的試算包裹</h4>
        <p>以下是您從試算表帶入的商品，請逐一為它們補上「物流單號」並提交：</p>
        <ul
          id="draft-queue-list"
          style="
            list-style-type: decimal;
            padding-left: 25px;
            margin: 0;
            font-weight: bold;
            color: #555;
          "
        ></ul>
      </div>
      <div class="form-section">
        <h3>📦 新增包裹預報</h3>
        <form id="forecast-form">
          <div class="form-grid-2">
            <div class="form-group">
              <label for="trackingNumber" class="required">物流單號</label>
              <input type="text" id="trackingNumber" required />
            </div>
            <div class="form-group">
              <label for="productName" class="required">商品名稱</label>
              <input type="text" id="productName" required />
            </div>
          </div>
          <div class="form-grid-2">
            <div class="form-group">
              <label for="quantity">數量</label>
              <input type="number" id="quantity" value="1" min="1" />
            </div>

            <div class="form-group">
              <label for="images">商品圖片 (最多5張, 報關用)</label>
              <input type="file" id="images" multiple accept="image/*" />
            </div>
          </div>
          <div class="form-group">
            <label for="note">備註</label>
            <textarea
              id="note"
              rows="3"
              placeholder="特殊需求或注意事項..."
            ></textarea>
          </div>
          <button type="submit" class="btn btn-primary">提交預報</button>
        </form>
      </div>

      <div class="auth-tabs" style="margin-top: 30px">
        <button id="tab-packages" class="tab-btn active">我的包裹</button>
        <button id="tab-shipments" class="tab-btn">我的集運單</button>
      </div>

      <div id="packages-section" class="tab-content active">
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th style="width: 50px">勾選</th>
                <th>狀態</th>
                <th>物流單號</th>
                <th>商品名稱</th>
                <th>件數</th>
                <th>總實重 (kg)</th>
                <th>總運費</th>
                <th>包裹詳情</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="packages-table-body">
              <tr>
                <td colspan="9" style="text-align: center">載入中...</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="shipment-action-bar">
          <button id="btn-create-shipment" class="btn btn-primary">
            合併打包 (建立集運單)
          </button>
        </div>
      </div>

      <div id="shipments-section" class="tab-content" style="display: none">
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>建立時間</th>
                <th>狀態</th>
                <th>收件人</th>
                <th>身分證</th>
                <th>包裹數量</th>
                <th>總金額</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="shipments-table-body">
              <tr>
                <td colspan="7" style="text-align: center">載入中...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div id="edit-profile-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <h2>編輯個人資料</h2>
        <form id="edit-profile-form">
          <div class="form-group">
            <label for="edit-name">姓名</label>
            <input type="text" id="edit-name" />
          </div>
          <div class="form-group">
            <label for="edit-phone">電話</label>
            <input type="tel" id="edit-phone" />
          </div>
          <div class="form-group">
            <label for="edit-address">預設地址</label>
            <input type="text" id="edit-address" />
          </div>
          <button type="submit" class="btn btn-primary">儲存變更</button>
        </form>
      </div>
    </div>

    <div id="edit-package-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <h2>編輯包裹預報</h2>
        <p style="color: #666; font-size: 14px">
          注意：包裹入庫後 (狀態非 PENDING) 即無法修改
        </p>
        <input type="hidden" id="edit-package-id" />
        <form id="edit-package-form">
          <div class="form-group">
            <label for="edit-trackingNumber" class="required">物流單號</label>
            <input type="text" id="edit-trackingNumber" required />
          </div>
          <div class="form-group">
            <label for="edit-productName" class="required">商品名稱</label>
            <input type="text" id="edit-productName" required />
          </div>
          <div class="form-group">
            <label for="edit-quantity">數量</label>
            <input type="number" id="edit-quantity" value="1" min="1" />
          </div>
          <div class="form-group">
            <label for="edit-note">備註</label>
            <textarea id="edit-note" rows="3"></textarea>
          </div>
          <button type="submit" class="btn btn-primary">儲存包裹變更</button>
        </form>
      </div>
    </div>

    <div id="create-shipment-modal" class="modal-overlay" style="display: none">
      <div class="modal-content modal-lg">
        <button class="modal-close">&times;</button>
        <h2 style="border-bottom: 1px solid #eee; padding-bottom: 10px">
          建立集運單 (合併打包)
        </h2>

        <form id="create-shipment-form">
          <div
            class="form-section"
            style="padding: 15px; background-color: #f8f9fa"
          >
            <h4 style="margin-top: 0">📦 包裹明細</h4>
            <div
              id="shipment-package-list"
              style="
                margin-bottom: 15px;
                max-height: 250px;
                overflow-y: auto;
                padding-right: 10px;
              "
            ></div>

            <div
              style="
                border-top: 2px solid #ddd;
                padding-top: 10px;
                text-align: right;
              "
            >
              <p style="margin: 5px 0; color: #666">預估總運費：</p>
              <div style="font-size: 2em; color: #d32f2f; font-weight: bold">
                NT$ <span id="shipment-total-cost">0</span>
              </div>
              <small id="shipment-fee-notice" style="color: #888"
                >(實際費用以管理員審核後為準)</small
              >

              <div
                id="shipment-warnings"
                style="
                  color: #d32f2f;
                  font-weight: bold;
                  margin-top: 10px;
                  text-align: right;
                  line-height: 1.6;
                "
              ></div>
            </div>
          </div>

          <div class="form-section" style="padding: 20px">
            <h4 style="margin-top: 0">📝 台灣收件資訊 (必填)</h4>

            <div class="form-group">
              <label for="ship-name" class="required">收件人姓名</label>
              <input type="text" id="ship-name" required />
            </div>

            <div class="form-group">
              <label for="ship-phone" class="required">聯絡電話</label>
              <input type="tel" id="ship-phone" required />
            </div>

            <div class="form-group">
              <label for="ship-address" class="required">收件地址</label>
              <input type="text" id="ship-address" required />
            </div>

            <div class="form-grid-2">
              <div class="form-group">
                <label for="ship-idNumber" class="required">身分證字號</label>
                <input type="text" id="ship-idNumber" required />
              </div>
              <div class="form-group">
                <label for="ship-taxId">統一編號 (選填)</label>
                <input type="text" id="ship-taxId" />
              </div>
            </div>

            <div class="form-group">
              <label for="ship-note">備註 (給管理員的留言)</label>
              <textarea
                id="ship-note"
                class="form-control"
                rows="2"
                placeholder="例如：請幫我加強包裝..."
              ></textarea>
            </div>
          </div>

          <button type="submit" class="btn btn-primary">確認送出集運單</button>
        </form>
      </div>
    </div>

    <div id="view-images-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <h2>包裹倉庫照片</h2>
        <div id="images-gallery" class="image-gallery"></div>
        <div class="text-center" style="margin-top: 20px">
          <button class="btn btn-primary modal-close-btn">關閉</button>
        </div>
      </div>
    </div>

    <div id="fee-details-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <h2
          style="
            color: #1a73e8;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
          "
        >
          運費計算詳情
        </h2>
        <div
          id="fee-details-content"
          style="line-height: 1.8; font-size: 15px; color: #333"
        ></div>
        <div class="text-center" style="margin-top: 20px">
          <button class="btn btn-primary modal-close-btn">我知道了</button>
        </div>
      </div>
    </div>

    <div id="bank-info-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <h2 style="text-align: center; color: #1a73e8">🎉 集運單建立成功！</h2>
        <div
          style="
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
            margin-top: 15px;
          "
        >
          <p style="margin-bottom: 10px; font-weight: bold; color: #555">
            請匯款至以下帳戶：
          </p>
          <ul
            id="bank-info-list"
            style="
              list-style: none;
              padding: 0;
              line-height: 2;
              font-size: 1.1em;
            "
          >
            <li>
              🏦 <strong>銀行：</strong>
              <span id="bank-name">第一銀行 (007) 台南分行</span>
            </li>
            <li>
              💰 <strong>帳號：</strong>
              <span id="bank-account" style="color: #d32f2f; font-weight: bold"
                >60110066477</span
              >
            </li>
            <li>
              👤 <strong>戶名：</strong>
              <span id="bank-holder">跑得快國際貿易有限公司</span>
            </li>
          </ul>

          <button
            type="button"
            id="btn-copy-bank-info"
            class="btn btn-secondary"
            style="width: 100%; margin-top: 15px; background-color: #1abc9c"
          >
            一鍵複製匯款資訊
          </button>
        </div>
        <p style="font-weight: bold; color: #d32f2f">
          匯款後請回傳轉帳憑證，並填寫電子信箱
        </p>
        <p style="font-weight: bold; color: #d32f2f; margin-top: 10px">
          待財務核對後無誤後，馬上為您安排裝櫃
        </p>
        <p style="color: #e74c3c; font-weight: 500; margin-top: 15px">
          🔺 傢俱、玻璃、陶瓷、大理石、岩板等，請廠家加強保護，破損不理賠！
        </p>
        <p style="margin-top: 10px">
          🔺
          海運派送到台灣指定地點(不上樓、不進門)，其他可加價上樓服務，重物請協助。
        </p>
        <p style="margin-top: 10px">
          🔺
          超重貨物請自行聯繫台灣端堆高機業者，費用由客戶支付，若需要堆高機聯繫方式可詢問司機。
        </p>
        <p style="margin-top: 10px">
          🔺 易碎品原則上不承運，如客戶自行加強包裝，並自願承擔破碎風險者例外。
        </p>
        <p style="margin-top: 10px">🔺 保丟不保損，以上請知悉。</p>
        <p
          style="
            margin-top: 15px;
            font-weight: bold;
            color: #27ae60;
            font-size: 1.1em;
          "
        >
          ☑️ 付款完成即表示同意上述說明。
        </p>
        <div class="text-center" style="margin-top: 20px">
          <button class="btn btn-primary modal-close-btn">我知道了</button>
        </div>
      </div>
    </div>

    <div id="upload-proof-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <h2>上傳付款憑證</h2>
        <input type="hidden" id="upload-proof-id" />
        <form id="upload-proof-form">
          <div class="form-group">
            <label>請上傳匯款截圖或收據照片</label>
            <input type="file" id="proof-file" accept="image/*" required />
          </div>
          <div
            id="proof-preview"
            style="margin-top: 10px; text-align: center"
          ></div>
          <button
            type="submit"
            class="btn btn-primary"
            style="margin-top: 15px"
          >
            確認上傳
          </button>
        </form>
      </div>
    </div>

    <div id="package-details-modal" class="modal-overlay" style="display: none">
      <div class="modal-content modal-lg">
        <button class="modal-close">&times;</button>
        <h2>包裹詳情</h2>

        <div class="form-section" style="padding: 15px; background: #fdfdfd">
          <h4 style="margin-top: 0">分箱明細</h4>

          <div
            id="details-boxes-list"
            style="max-height: 250px; overflow-y: auto; padding-right: 10px"
          ></div>

          <div
            class="detail-summary"
            style="
              border-top: 2px solid #ddd;
              padding-top: 15px;
              margin-top: 15px;
            "
          >
            <strong>總計：</strong>
            <span id="details-total-boxes">0</span> 箱,
            <span id="details-total-weight">0.0</span> kg, 總運費
            <span id="details-total-fee">NT$ 0</span>
          </div>
        </div>

        <div class_="form-section" style="padding: 15px; background: #fdfdfd">
          <h4 style="margin-top: 0">倉庫照片</h4>
          <div id="details-images-gallery" class="image-gallery"></div>
        </div>

        <button
          type="button"
          class="btn btn-primary modal-close-btn"
          style="width: 100%"
        >
          關閉
        </button>
      </div>
    </div>

    <div
      id="shipment-details-modal"
      class="modal-overlay"
      style="display: none"
    >
      <div class="modal-content modal-lg">
        <button class="modal-close">&times;</button>
        <h2
          style="
            color: #1a73e8;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
          "
        >
          集運單詳情
        </h2>

        <div class="shipment-details-grid">
          <div class="form-section">
            <h4 style="margin-top: 0">📝 收件人資訊</h4>
            <div class="info-grid-simple">
              <p>
                <strong>收件人:</strong> <span id="detail-ship-name">-</span>
              </p>
              <p>
                <strong>連絡電話:</strong> <span id="detail-ship-phone">-</span>
              </p>
              <p>
                <strong>身分證號:</strong> <span id="detail-ship-id"></span>
              </p>
              <p>
                <strong>收件地址:</strong>
                <span id="detail-ship-address">-</span>
              </p>
              <p>
                <strong>客戶備註:</strong>
                <span id="detail-ship-note" style="color: #d32f2f">-</span>
              </p>
            </div>
          </div>

          <div class="form-section">
            <h4 style="margin-top: 0">🚚 物流與付款</h4>
            <div class="info-grid-simple">
              <p>
                <strong>訂單狀態:</strong>
                <span id="detail-ship-status" class="status-badge">-</span>
              </p>
              <p>
                <strong>總運費:</strong>
                <span
                  id="detail-ship-cost"
                  style="font-weight: bold; color: #d32f2f; font-size: 1.2em"
                  >-</span
                >
              </p>
              <p>
                <strong>付款憑證:</strong>
                <span id="detail-ship-payment">-</span>
              </p>
              <p>
                <strong>台灣物流單號:</strong>
                <span id="detail-ship-tw-tracking">-</span>
              </p>
            </div>
          </div>
        </div>

        <div class="form-section" style="margin-top: 15px; background: #fdfdfd">
          <h4 style="margin-top: 0">📦 包含包裹清單</h4>
          <div id="detail-package-list"></div>
        </div>

        <div class="text-center" style="margin-top: 20px">
          <button class="btn btn-primary modal-close-btn">關閉</button>
        </div>
      </div>
    </div>

    <script src="js/apiConfig.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/dashboard.js"></script>
  </body>
</html>
