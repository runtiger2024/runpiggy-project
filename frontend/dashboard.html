<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>會員中心 | 我的家具專線</title>
    <link rel="icon" href="assets/logo.png" type="image/png" />
    <script src="js/styleLoader.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body class="dashboard-theme">
    <div class="container dashboard-container">
      <header class="dashboard-header">
        <div class="header-left">
          <img src="assets/logo.png" alt="Logo" class="header-logo-sm" />
          <h1>會員中心</h1>
        </div>
        <nav class="main-nav header-nav-right"></nav>
      </header>

      <div id="message-box" class="alert" style="display: none"></div>

      <div class="user-profile-card">
        <div class="profile-bg"></div>
        <div class="profile-content">
          <div class="avatar-circle">
            <i class="fas fa-user"></i>
          </div>
          <div class="profile-details">
            <h2 id="welcome-message">歡迎回來</h2>
            <div class="user-meta">
              <span class="meta-item"
                ><i class="fas fa-envelope"></i>
                <span id="user-email">-</span></span
              >
              <span class="meta-item"
                ><i class="fas fa-phone"></i>
                <span id="user-phone">-</span></span
              >
            </div>
            <div class="user-address">
              <i class="fas fa-map-marker-alt"></i>
              <span id="user-address">-</span>
            </div>
          </div>
          <button
            id="btn-edit-profile"
            class="btn btn-outline-light btn-sm btn-edit-profile"
          >
            <i class="fas fa-pen"></i> 編輯
          </button>
        </div>
      </div>

      <div
        id="draft-queue-container"
        class="notice-card warning"
        style="display: none"
      >
        <div class="notice-icon"><i class="fas fa-clock"></i></div>
        <div class="notice-content">
          <h4>待處理的試算包裹</h4>
          <p>您有從試算表帶入的商品，請補上物流單號：</p>
          <ul id="draft-queue-list"></ul>
        </div>
      </div>

      <div class="section-card forecast-section">
        <div class="card-header">
          <h3><i class="fas fa-box-open"></i> 預報新包裹</h3>
        </div>
        <div class="card-body">
          <form id="forecast-form" class="forecast-form-grid">
            <div class="form-group">
              <label class="required">物流單號</label>
              <input
                type="text"
                id="trackingNumber"
                placeholder="掃描或輸入單號"
                required
              />
            </div>
            <div class="form-group">
              <label class="required">商品名稱</label>
              <input
                type="text"
                id="productName"
                placeholder="例：書桌"
                required
              />
            </div>
            <div class="form-group short">
              <label>數量</label>
              <input type="number" id="quantity" value="1" min="1" />
            </div>
            <div class="form-group short">
              <label>照片 (報關用)</label>
              <label class="file-upload-btn">
                <i class="fas fa-camera"></i> 上傳
                <input
                  type="file"
                  id="images"
                  multiple
                  accept="image/*"
                  style="display: none"
                />
              </label>
              <span class="file-count" id="file-count-display"></span>
            </div>
            <div class="form-group full">
              <label>備註</label>
              <input type="text" id="note" placeholder="特殊需求..." />
            </div>
            <div class="form-group action">
              <button type="submit" class="btn btn-primary btn-add-cart">
                <i class="fas fa-plus-circle"></i> 提交預報
              </button>
            </div>
          </form>
        </div>
      </div>

      <div class="dashboard-tabs">
        <button id="tab-packages" class="tab-btn active">
          <i class="fas fa-boxes"></i> 我的包裹 (待入庫)
        </button>
        <button id="tab-shipments" class="tab-btn">
          <i class="fas fa-shipping-fast"></i> 我的集運單 (訂單)
        </button>
      </div>

      <div id="packages-section" class="tab-content active">
        <div class="table-responsive cart-style">
          <table>
            <thead>
              <tr>
                <th width="40">選</th>
                <th>狀態</th>
                <th>物流單號/商品</th>
                <th>規格(件數/重/費)</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="packages-table-body">
              <tr>
                <td colspan="5" class="text-center">載入中...</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="sticky-checkout-bar">
          <div class="checkout-info">
            已選 <span id="selected-pkg-count" class="highlight">0</span> 件包裹
          </div>
          <button id="btn-create-shipment" class="btn btn-primary btn-checkout">
            合併打包 (去結帳)
          </button>
        </div>
      </div>

      <div id="shipments-section" class="tab-content" style="display: none">
        <div class="order-status-filter"></div>

        <div class="table-responsive order-style">
          <table>
            <thead>
              <tr>
                <th>訂單時間</th>
                <th>狀態</th>
                <th>收件資訊</th>
                <th>總金額</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="shipments-table-body">
              <tr>
                <td colspan="5" class="text-center">載入中...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div id="edit-profile-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <h3>編輯個人資料</h3>
        <form id="edit-profile-form">
          <div class="form-group">
            <label>姓名</label><input type="text" id="edit-name" />
          </div>
          <div class="form-group">
            <label>電話</label><input type="tel" id="edit-phone" />
          </div>
          <div class="form-group">
            <label>預設地址</label><input type="text" id="edit-address" />
          </div>
          <button type="submit" class="btn btn-primary">儲存</button>
        </form>
      </div>
    </div>

    <div id="edit-package-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <h3>編輯包裹</h3>
        <input type="hidden" id="edit-package-id" />
        <form id="edit-package-form">
          <div class="form-group">
            <label>物流單號</label
            ><input type="text" id="edit-trackingNumber" required />
          </div>
          <div class="form-group">
            <label>商品名稱</label
            ><input type="text" id="edit-productName" required />
          </div>
          <div class="form-group">
            <label>數量</label
            ><input type="number" id="edit-quantity" min="1" />
          </div>
          <div class="form-group">
            <label>備註</label><input type="text" id="edit-note" />
          </div>

          <div id="edit-package-images-container"></div>

          <button type="submit" class="btn btn-primary">儲存變更</button>
        </form>
      </div>
    </div>

    <div id="create-shipment-modal" class="modal-overlay" style="display: none">
      <div class="modal-content modal-lg checkout-modal">
        <button class="modal-close">&times;</button>
        <div class="modal-header">
          <h3>確認訂單 (合併打包)</h3>
        </div>

        <form id="create-shipment-form">
          <div class="checkout-layout">
            <div class="checkout-items">
              <h4>📦 包裹清單</h4>
              <div id="shipment-package-list" class="pkg-list-scroll"></div>

              <div class="checkout-summary">
                <div class="warning-box" id="shipment-warnings"></div>
                <div class="total-box">
                  預估運費：<span class="total-price"
                    >NT$ <span id="shipment-total-cost">0</span></span
                  >
                  <small id="shipment-fee-notice"></small>
                </div>
              </div>
            </div>

            <div class="checkout-info-form">
              <h4>📝 收件資訊</h4>
              <div class="form-group">
                <label class="required">收件人</label
                ><input type="text" id="ship-name" required />
              </div>
              <div class="form-group">
                <label class="required">電話</label
                ><input type="tel" id="ship-phone" required />
              </div>

              <div class="form-group">
                <label class="required">配送地區 (含偏遠費)</label>
                <div class="search-box-mini">
                  <input
                    type="text"
                    id="ship-area-search"
                    placeholder="搜尋地區..."
                  />
                  <div id="ship-search-results" class="search-dropdown"></div>
                </div>
                <select
                  id="ship-delivery-location"
                  class="form-control"
                  required
                >
                  <option value="" selected disabled>--- 載入中 ---</option>
                </select>
                <div
                  id="ship-remote-area-info"
                  class="area-info-box"
                  style="display: none"
                >
                  選定：<span id="ship-selected-area-name"></span> (<span
                    id="ship-selected-area-fee"
                    class="fee-text"
                  ></span
                  >)
                </div>
              </div>

              <div class="form-group">
                <label class="required">詳細地址</label
                ><input
                  type="text"
                  id="ship-street-address"
                  placeholder="路/街/號/樓"
                  required
                />
              </div>

              <div class="form-row">
                <div class="form-group half">
                  <label class="required">身分證</label
                  ><input type="text" id="ship-idNumber" required />
                </div>
                <div class="form-group half">
                  <label>統編 (選填)</label
                  ><input type="text" id="ship-taxId" />
                </div>
              </div>
              <div class="form-group">
                <label>發票抬頭</label
                ><input type="text" id="ship-invoiceTitle" />
              </div>

              <div class="proof-section">
                <label>🛒 商品證明 (必填其一)</label>
                <input
                  type="url"
                  id="ship-product-url"
                  placeholder="購買連結網址"
                />
                <div class="or-divider">或</div>
                <label class="file-upload-box">
                  <span>上傳訂單截圖</span>
                  <input
                    type="file"
                    id="ship-product-images"
                    multiple
                    accept="image/*"
                  />
                </label>
              </div>

              <div class="form-group">
                <label>備註</label><input type="text" id="ship-note" />
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button
              type="submit"
              class="btn btn-primary btn-block btn-place-order"
            >
              提交訂單
            </button>
          </div>
        </form>
      </div>
    </div>

    <div id="bank-info-modal" class="modal-overlay" style="display: none">
      <div class="modal-content success-modal">
        <button class="modal-close">&times;</button>
        <div class="success-icon"><i class="fas fa-check-circle"></i></div>
        <h3>訂單建立成功！</h3>

        <div class="bank-details">
          <p>請匯款至：</p>
          <div class="bank-card">
            <div class="bank-row">
              <span>銀行：</span><span id="bank-name">第一銀行 (007)</span>
            </div>
            <div class="bank-row">
              <span>帳號：</span
              ><span id="bank-account" class="copy-target">60110066477</span>
            </div>
            <div class="bank-row">
              <span>戶名：</span><span id="bank-holder">跑得快國際貿易</span>
            </div>
          </div>
          <button
            id="btn-copy-bank-info"
            class="btn btn-outline-success btn-sm"
          >
            複製資訊
          </button>
        </div>

        <div class="modal-footer">
          <button class="btn btn-primary modal-close-btn">我知道了</button>
        </div>
      </div>
    </div>

    <div id="upload-proof-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <h3>上傳付款憑證</h3>
        <input type="hidden" id="upload-proof-id" />
        <form id="upload-proof-form">
          <div class="form-group">
            <input type="file" id="proof-file" accept="image/*" required />
          </div>
          <button type="submit" class="btn btn-primary">上傳</button>
        </form>
      </div>
    </div>

    <div id="package-details-modal" class="modal-overlay" style="display: none">
      <div class="modal-content modal-lg">
        <button class="modal-close">&times;</button>
        <h3>包裹入庫詳情</h3>
        <div id="details-boxes-list" class="box-list"></div>
        <div class="detail-total-row">
          <span>總重：<span id="details-total-weight"></span> kg</span>
          <span>運費：<span id="details-total-fee" class="price"></span></span>
        </div>
        <hr />
        <h4>倉庫實拍</h4>
        <div id="details-images-gallery" class="gallery-grid"></div>
        <button
          class="btn btn-light modal-close-btn"
          style="margin-top: 15px; width: 100%"
        >
          關閉
        </button>
      </div>
    </div>

    <div id="view-images-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <h3>照片瀏覽</h3>
        <div id="images-gallery" class="gallery-grid"></div>
      </div>
    </div>

    <script src="js/apiConfig.js"></script>
    <script src="js/shippingData.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/dashboard.js"></script>
  </body>
</html>
