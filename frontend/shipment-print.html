<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é›†é‹å‡ºè²¨å–® / å ±é—œæ˜ç´° - å°è·‘è±¬</title>
    <link rel="icon" href="assets/logo.png" type="image/png" />
    <script src="js/styleLoader.js"></script>
    <style>
      :root {
        --border-color: #000;
      }

      body {
        font-family: "Microsoft JhengHei", "Heiti TC", Arial, sans-serif;
        background-color: #525659;
        margin: 0;
        padding: 20px;
        color: #000;
      }

      .page-container {
        background: white;
        width: 210mm;
        min-height: 297mm;
        margin: 0 auto;
        padding: 15mm 15mm;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
        position: relative;
        box-sizing: border-box;
      }

      @media print {
        @page {
          size: A4;
          margin: 0;
        }
        body {
          background: none;
          padding: 0;
          margin: 0;
          -webkit-print-color-adjust: exact;
          print-color-adjust: exact;
        }
        .page-container {
          width: 100%;
          min-height: 100vh;
          margin: 0;
          padding: 10mm 15mm;
          box-shadow: none;
          border: none;
        }
        .no-print {
          display: none !important;
        }
        .page-break {
          page-break-before: always;
        }
      }

      /* æ¨™é ­å€ */
      .doc-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        border-bottom: 2px solid var(--border-color);
        padding-bottom: 10px;
        margin-bottom: 15px;
      }
      .company-brand {
        display: flex;
        align-items: center;
        gap: 15px;
      }
      .company-brand img {
        height: 60px;
        filter: grayscale(100%);
      }
      .company-title h1 {
        margin: 0;
        font-size: 24px;
        letter-spacing: 2px;
        font-weight: 900;
      }
      .company-title span {
        font-size: 14px;
        font-weight: bold;
      }
      .doc-meta {
        text-align: right;
        font-size: 12px;
        line-height: 1.4;
      }
      .doc-title-box {
        text-align: center;
        margin: 15px 0;
      }
      .doc-title-box h2 {
        margin: 0;
        font-size: 22px;
        text-decoration: underline;
        text-underline-offset: 5px;
      }

      /* è³‡è¨Šç¶²æ ¼å€ */
      .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 15px;
        border: 1px solid var(--border-color);
        padding: 10px;
      }
      .info-column {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .info-row {
        display: flex;
        font-size: 13px; /* ç¨å¾®ç¸®å°å­—é«”ä»¥å®¹ç´æ›´å¤šè³‡è¨Š */
        align-items: baseline;
      }
      .info-label {
        font-weight: bold;
        min-width: 90px; /* åŠ å¯¬æ¨™ç±¤æ¬„ä½ */
        color: #333;
      }
      .info-value {
        flex: 1;
        border-bottom: 1px dotted #ccc;
        padding-left: 5px;
        min-height: 18px;
      }

      /* è¡¨æ ¼æ¨£å¼ */
      .standard-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 15px;
        font-size: 11px; /* ç¸®å°å­—é«”ä»¥é¡¯ç¤ºæ›´å¤šç´°ç¯€ */
      }
      .standard-table th,
      .standard-table td {
        border: 1px solid var(--border-color);
        padding: 5px;
        text-align: center;
        vertical-align: middle;
      }
      .standard-table th {
        background-color: #f0f0f0;
        font-weight: bold;
        padding: 6px;
      }
      .standard-table td.text-left {
        text-align: left;
      }
      .standard-table td.text-right {
        text-align: right;
      }
      .wh-remark {
        color: #d32f2f;
        font-style: italic;
        display: block;
        margin-top: 2px;
        font-size: 0.9em;
      }

      /* ç¸½è¨ˆå€ */
      .totals-section {
        display: flex;
        justify-content: flex-end;
        margin-top: -16px;
        margin-bottom: 15px;
      }
      .totals-box {
        border: 1px solid var(--border-color);
        border-top: none;
        padding: 8px 15px;
        min-width: 250px;
        font-size: 13px;
        background: #fafafa;
      }
      .total-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 4px;
      }
      .total-row.final {
        font-weight: bold;
        font-size: 15px;
        border-top: 1px solid #ccc;
        padding-top: 5px;
        margin-top: 5px;
      }

      /* é™„åŠ æœå‹™å€ */
      .additional-services-box {
        border: 2px solid #000;
        padding: 8px;
        margin-bottom: 15px;
        font-size: 12px;
      }
      .services-title {
        font-weight: bold;
        margin-bottom: 6px;
        border-bottom: 1px solid #ccc;
        padding-bottom: 4px;
        display: flex;
        justify-content: space-between;
      }
      .services-list {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }
      .service-item {
        display: flex;
        align-items: flex-start;
      }
      .service-checkbox {
        margin-right: 5px;
        font-family: "Segoe UI Symbol", sans-serif;
      }

      /* åº•éƒ¨ç°½åå€ */
      .bottom-section {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
        font-size: 13px;
      }
      .remarks-box {
        width: 60%;
        border: 1px solid var(--border-color);
        padding: 8px;
        min-height: 70px;
      }
      .signature-box {
        width: 35%;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        align-items: center;
      }
      .signature-line {
        width: 100%;
        border-bottom: 1px solid var(--border-color);
        margin-top: 30px;
        margin-bottom: 8px;
      }

      /* ç…§ç‰‡å€ */
      .photos-header {
        border-bottom: 1px solid #000;
        margin-bottom: 10px;
        padding-bottom: 4px;
        font-size: 14px;
        font-weight: bold;
      }
      .photos-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
      }
      .photo-wrapper {
        border: 1px solid #ccc;
        padding: 4px;
        text-align: center;
        page-break-inside: avoid;
      }
      .photo-wrapper img {
        width: 100%;
        height: 100px;
        object-fit: contain;
        display: block;
      }
      .photo-caption {
        font-size: 9px;
        margin-top: 4px;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
      }

      /* æ“ä½œæŒ‰éˆ• */
      .action-bar {
        position: fixed;
        top: 20px;
        right: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        z-index: 999;
      }
      .btn {
        padding: 12px 24px;
        background: #1a73e8;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .watermark {
        position: absolute;
        top: 40%;
        left: 50%;
        transform: translate(-50%, -50%) rotate(-45deg);
        font-size: 100px;
        color: rgba(0, 0, 0, 0.03);
        pointer-events: none;
        font-weight: bold;
        white-space: nowrap;
        z-index: 0;
      }
    </style>
  </head>
  <body>
    <div class="action-bar no-print">
      <button class="btn" onclick="window.print()">ğŸ–¨ï¸ åˆ—å° / å„²å­˜ PDF</button>
      <button class="btn" onclick="window.close()" style="background: #5f6368">
        é—œé–‰è¦–çª—
      </button>
    </div>

    <div
      id="loading"
      style="text-align: center; color: white; margin-top: 100px"
    >
      è³‡æ–™è¼‰å…¥ä¸­...
    </div>

    <div id="print-content" class="page-container" style="display: none">
      <div class="watermark">RUNPIGGY LOGISTICS</div>

      <div class="doc-header">
        <div class="company-brand">
          <img src="assets/logo.png" alt="Logo" />
          <div class="company-title">
            <h1>å°è·‘è±¬é›†é‹</h1>
            <span>RUNPIGGY INTERNATIONAL</span>
          </div>
        </div>
        <div class="doc-meta">
          <div>çµ±ä¸€ç·¨è™Ÿï¼š60660304</div>
          <div>Email: 2runtigers@gmail.com</div>
          <div>LINE: @runpiggy</div>
          <div>åˆ—å°æ™‚é–“: <span id="print-date"></span></div>
        </div>
      </div>

      <div class="doc-title-box">
        <h2>é›†é‹å‡ºè²¨æ˜ç´°å–® / PACKING LIST</h2>
      </div>

      <div class="info-grid">
        <div class="info-column">
          <div class="info-row">
            <span class="info-label">è¨‚å–®ç·¨è™Ÿï¼š</span>
            <span class="info-value" id="p-id"></span>
          </div>
          <div class="info-row">
            <span class="info-label">å»ºç«‹æ—¥æœŸï¼š</span>
            <span class="info-value" id="p-date"></span>
          </div>
          <div class="info-row">
            <span class="info-label">è¨‚å–®ç‹€æ…‹ï¼š</span>
            <span class="info-value" id="p-status"></span>
          </div>
          <div class="info-row">
            <span class="info-label">å°ç£å–®è™Ÿï¼š</span>
            <span class="info-value" id="p-tw-tracking"></span>
          </div>
          <div class="info-row">
            <span class="info-label">è£æ«ƒæ—¥æœŸï¼š</span>
            <span class="info-value" id="p-loading-date">-</span>
          </div>
        </div>
        <div class="info-column">
          <div class="info-row">
            <span class="info-label">æ”¶ä»¶äººï¼š</span>
            <span class="info-value" id="p-name"></span>
          </div>
          <div class="info-row">
            <span class="info-label">è¯çµ¡é›»è©±ï¼š</span>
            <span class="info-value" id="p-phone"></span>
          </div>
          <div class="info-row">
            <span class="info-label">èº«åˆ†è­‰è™Ÿï¼š</span>
            <span class="info-value" id="p-idnum"></span>
          </div>
          <div class="info-row">
            <span class="info-label">é…é€åœ°å€ï¼š</span>
            <span
              class="info-value"
              id="p-address"
              style="font-size: 12px"
            ></span>
          </div>
        </div>
      </div>

      <div
        id="invoice-section"
        class="info-grid"
        style="display: none; border-top: none; margin-top: -16px"
      >
        <div class="info-column">
          <div class="info-row">
            <span class="info-label">ç™¼ç¥¨çµ±ç·¨ï¼š</span>
            <span class="info-value" id="p-tax-id">-</span>
          </div>
          <div class="info-row">
            <span class="info-label">ç™¼ç¥¨æŠ¬é ­ï¼š</span>
            <span class="info-value" id="p-invoice-title">-</span>
          </div>
        </div>
        <div class="info-column">
          <div class="info-row">
            <span class="info-label">è¼‰å…·æ¢ç¢¼ï¼š</span>
            <span class="info-value" id="p-carrier">-</span>
          </div>
          <div class="info-row">
            <span class="info-label">ç™¼ç¥¨è™Ÿç¢¼ï¼š</span>
            <span class="info-value" id="p-invoice-num">-</span>
          </div>
        </div>
      </div>

      <table class="standard-table">
        <thead>
          <tr>
            <th style="width: 4%">No.</th>
            <th style="width: 18%">ç‰©æµå–®è™Ÿ (Tracking No.)</th>
            <th style="width: 25%">å•†å“åç¨± (Description)</th>
            <th style="width: 6%">æ•¸é‡</th>
            <th style="width: 13%">å…¥åº«å¯¦é‡ (KG)</th>
            <th style="width: 10%">æç© (æ)</th>
            <th style="width: 24%">å‚™è¨» (Remark)</th>
          </tr>
        </thead>
        <tbody id="p-pkg-body"></tbody>
      </table>

      <div class="totals-section">
        <div class="totals-box">
          <div class="total-row">
            <span>ç¸½å•†å“ä»¶æ•¸ï¼š</span>
            <span id="p-total-qty">0</span>
          </div>
          <div class="total-row">
            <span>å…¥åº«ç¸½ç®±æ•¸ï¼š</span>
            <span id="p-total-boxes">0</span>
          </div>
          <div class="total-row">
            <span>ç¸½é‡é‡ï¼š</span>
            <span id="p-total-weight">0.0 kg</span>
          </div>
          <div class="total-row">
            <span>ç¸½æç©ï¼š</span>
            <span id="p-total-cai">0.0 æ</span>
          </div>
          <div class="total-row final">
            <span>é‹è²»ç¸½è¨ˆï¼š</span>
            <span id="p-total-cost">NT$ 0</span>
          </div>
        </div>
      </div>

      <div
        id="p-services-section"
        class="additional-services-box"
        style="display: none"
      >
        <div class="services-title">
          <span>ğŸ› ï¸ é™„åŠ æœå‹™éœ€æ±‚ (Additional Services)</span>
          <span style="font-weight: normal; font-size: 11px">â€» å¸æ©Ÿå­˜æŸ¥</span>
        </div>
        <div id="p-services-list" class="services-list"></div>
        <div
          class="service-warning"
          style="
            margin-top: 5px;
            text-align: center;
            border-top: 1px dashed #ccc;
            padding-top: 5px;
            font-weight: bold;
            color: #d32f2f;
          "
        >
          âš ï¸
          æé†’ï¼šå¯¦éš›å ±åƒ¹ä»¥ç¾å ´æƒ…æ³ç‚ºæº–ï¼Œé™„åŠ è²»ç”¨è«‹å®¢æˆ¶ç›´æ¥æ”¯ä»˜çµ¦æ´¾é€å¸æ©Ÿç¢ºèªã€‚
        </div>
      </div>

      <div class="bottom-section">
        <div class="remarks-box">
          <strong>å®¢æˆ¶è¨‚å–®å‚™è¨» / Order Notes:</strong><br />
          <span id="p-note" style="white-space: pre-wrap; color: #555"></span>
        </div>
        <div class="signature-box">
          <div class="signature-line"></div>
          <div>æ”¶ä»¶äººç°½å / Signature</div>
        </div>
      </div>

      <div class="page-break"></div>

      <div class="photos-section" id="photo-section" style="margin-top: 20px">
        <div class="photos-header">ğŸ“· è²¨ç‰©/å€‰åº«ç…§ç‰‡è¨˜éŒ„ (Photos)</div>
        <div class="photos-grid" id="p-photos-grid"></div>
      </div>
    </div>

    <script src="js/apiConfig.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        const params = new URLSearchParams(window.location.search);
        const shipmentId = params.get("id");

        const adminToken = localStorage.getItem("admin_token");
        const clientToken = localStorage.getItem("token");
        const isPrivileged = !!adminToken;
        const token = adminToken || clientToken;

        if (!shipmentId || !token) {
          alert("ç„¡æ•ˆçš„é€£çµæˆ–æœªç™»å…¥");
          window.close();
          return;
        }

        try {
          const response = await fetch(
            `${API_BASE_URL}/api/shipments/${shipmentId}`,
            { headers: { Authorization: `Bearer ${token}` } }
          );
          const data = await response.json();
          if (!response.ok) throw new Error(data.message);

          renderShipment(data.shipment, isPrivileged);

          document.getElementById("loading").style.display = "none";
          document.getElementById("print-content").style.display = "block";

          const now = new Date();
          document.getElementById(
            "print-date"
          ).textContent = `${now.getFullYear()}/${(now.getMonth() + 1)
            .toString()
            .padStart(2, "0")}/${now
            .getDate()
            .toString()
            .padStart(2, "0")} ${now
            .getHours()
            .toString()
            .padStart(2, "0")}:${now.getMinutes().toString().padStart(2, "0")}`;
        } catch (error) {
          alert("è¼‰å…¥å¤±æ•—ï¼š" + error.message);
          document.getElementById("loading").textContent =
            "è¼‰å…¥å¤±æ•—ï¼Œè«‹é—œé–‰è¦–çª—é‡è©¦";
        }
      });

      function formatSensitiveData(str, type, isPrivileged) {
        if (!str) return "-";
        if (isPrivileged) return str;

        if (type === "phone") {
          if (str.length > 7) {
            return str.substring(0, 2) + "****" + str.substring(str.length - 4);
          }
          return str;
        } else if (type === "id") {
          // ä¿®æ­£ï¼šä¾ç…§éœ€æ±‚é¡¯ç¤ºã€Œ*****ã€+ æœ«4ç¢¼
          if (str.length > 4) {
            return "*****" + str.slice(-4);
          }
          return "*****" + str;
        }
        return str;
      }

      function renderShipment(ship, isPrivileged) {
        // ç‹€æ…‹å°ç…§
        const shipmentStatusMap = {
          PENDING_PAYMENT: "å¾…ä»˜æ¬¾",
          PENDING_REVIEW: "ä»˜æ¬¾å¯©æ ¸ä¸­",
          PROCESSING: "å·²æ”¶æ¬¾ï¼Œå®‰æ’è£æ«ƒ",
          SHIPPED: "å·²è£æ«ƒ",
          CUSTOMS_CHECK: "æµ·é—œæŸ¥é©—ä¸­",
          UNSTUFFING: "æ‹†æ«ƒæ´¾é€ä¸­",
          COMPLETED: "å·²å®Œæˆ",
          RETURNED: "è¨‚å–®è¢«é€€å›",
          CANCELLED: "å·²å–æ¶ˆ",
        };
        let statusText = shipmentStatusMap[ship.status] || ship.status;
        if (ship.status === "PENDING_PAYMENT" && ship.paymentProof) {
          statusText = "å·²ä»˜æ¬¾ (å¾…å¯©æ ¸)";
        }
        if (ship.status === "RETURNED" && ship.returnReason) {
          statusText += ` (åŸå› : ${ship.returnReason})`;
        }

        // --- åŸºæœ¬è³‡æ–™ ---
        document.getElementById("p-id").textContent = ship.id
          .slice(-8)
          .toUpperCase();
        document.getElementById("p-date").textContent = new Date(
          ship.createdAt
        ).toLocaleDateString();
        document.getElementById("p-status").textContent = statusText;
        document.getElementById("p-tw-tracking").textContent =
          ship.trackingNumberTW || "å°šæœªç”¢ç”Ÿ";
        document.getElementById("p-loading-date").textContent = ship.loadingDate
          ? new Date(ship.loadingDate).toLocaleDateString()
          : "-";

        // --- æ”¶ä»¶äººè³‡æ–™ (å€‹è³‡è™•ç†) ---
        document.getElementById("p-name").textContent = ship.recipientName;
        document.getElementById("p-phone").textContent = formatSensitiveData(
          ship.phone,
          "phone",
          isPrivileged
        );
        document.getElementById("p-idnum").textContent = formatSensitiveData(
          ship.idNumber,
          "id",
          isPrivileged
        );
        document.getElementById("p-address").textContent = ship.shippingAddress;
        document.getElementById("p-note").textContent = ship.note || "ç„¡";

        // --- ç™¼ç¥¨èˆ‡è¼‰å…·è©³ç´°è³‡æ–™ (å¦‚æœæœ‰å‰‡é¡¯ç¤º) ---
        const hasInvoiceInfo =
          ship.taxId ||
          ship.invoiceTitle ||
          ship.carrierType ||
          ship.invoiceNumber;
        if (hasInvoiceInfo) {
          document.getElementById("invoice-section").style.display = "grid";
          document.getElementById("p-tax-id").textContent = ship.taxId || "-";
          document.getElementById("p-invoice-title").textContent =
            ship.invoiceTitle || "-";

          // çµ„åˆè¼‰å…·é¡¯ç¤º
          let carrierDisplay = "-";
          if (ship.carrierType && ship.carrierId) {
            carrierDisplay = `${ship.carrierType}: ${ship.carrierId}`;
          } else if (ship.carrierId) {
            carrierDisplay = ship.carrierId;
          }
          document.getElementById("p-carrier").textContent = carrierDisplay;

          // çµ„åˆç™¼ç¥¨è™Ÿç¢¼é¡¯ç¤º
          let invoiceDisplay = ship.invoiceNumber || "-";
          if (ship.invoiceStatus === "VOID") invoiceDisplay += " (å·²ä½œå»¢)";
          document.getElementById("p-invoice-num").textContent = invoiceDisplay;
        }

        // --- é™„åŠ æœå‹™ ---
        const svcs = ship.additionalServices || {};
        const svcContainer = document.getElementById("p-services-list");
        const svcSection = document.getElementById("p-services-section");
        let svcHtml = "";
        let hasService = false;

        const svcMap = [
          { key: "floor", label: "ä¸Šæ¨“æ¬é‹" },
          { key: "wood", label: "å›æ”¶æœ¨æ¶" },
          { key: "assembly", label: "å‚¢ä¿±çµ„è£" },
          { key: "old", label: "å›æ”¶èˆŠå‚¢ä¿±" },
        ];

        svcMap.forEach((s) => {
          const data = svcs[s.key];
          if (data && data.selected) {
            hasService = true;
            let detail = "";
            if (s.key === "floor") {
              detail += data.hasElevator
                ? " (æœ‰é›»æ¢¯)"
                : " <b style='color:red; border-bottom:1px solid red;'>â˜… ç„¡é›»æ¢¯</b>";
            }
            if (data.note)
              detail += ` <span style="font-style:italic">(${data.note})</span>`;
            svcHtml += `<div class="service-item"><span class="service-checkbox">â˜‘</span> <strong>${s.label}</strong>${detail}</div>`;
          } else {
            svcHtml += `<div class="service-item" style="opacity:0.4;"><span class="service-checkbox">â˜</span> <span>${s.label}</span></div>`;
          }
        });

        if (hasService) {
          svcContainer.innerHTML = svcHtml;
          svcSection.style.display = "block";
        }

        // --- åŒ…è£¹è¡¨æ ¼ ---
        const tbody = document.getElementById("p-pkg-body");
        const photosGrid = document.getElementById("p-photos-grid");
        let totalQty = 0;
        let grandTotalWeight = 0;
        let grandTotalCai = 0;
        let grandTotalBoxes = 0;

        ship.packages.forEach((pkg, index) => {
          const tr = document.createElement("tr");

          let weightInfo = "-";
          let caiInfo = "-";
          let pkgWeight = 0;
          let pkgCai = 0;
          let boxCount = 0;

          if (pkg.arrivedBoxes && pkg.arrivedBoxes.length > 0) {
            pkgWeight = pkg.arrivedBoxes.reduce(
              (acc, b) => acc + (parseFloat(b.weight) || 0),
              0
            );
            pkgCai = pkg.arrivedBoxes.reduce(
              (acc, b) => acc + (parseFloat(b.cai) || 0),
              0
            );
            boxCount = pkg.arrivedBoxes.length;

            weightInfo = `<div>${pkgWeight.toFixed(
              1
            )} kg</div><div style="font-size:10px; color:#666">å…± ${boxCount} ç®±</div>`;
            caiInfo = pkgCai.toFixed(2);
          } else {
            weightInfo = "(å¾…æ¸¬é‡)";
          }

          grandTotalWeight += pkgWeight;
          grandTotalCai += pkgCai;
          grandTotalBoxes += boxCount;
          totalQty += pkg.quantity;

          // æ•´åˆå‚™è¨»ï¼šé¡¯ç¤ºå®¢æˆ¶å‚™è¨» + å€‰åº«å‚™è¨»
          let noteHtml = pkg.note || "";
          if (pkg.warehouseRemark) {
            if (noteHtml) noteHtml += "<br>";
            noteHtml += `<span class="wh-remark">[å€‰] ${pkg.warehouseRemark}</span>`;
          }

          tr.innerHTML = `
            <td>${index + 1}</td>
            <td class="text-left" style="font-family: monospace; font-weight:bold;">${
              pkg.trackingNumber
            }</td>
            <td class="text-left">${pkg.productName}</td>
            <td>${pkg.quantity}</td>
            <td>${weightInfo}</td>
            <td>${caiInfo}</td> 
            <td class="text-left" style="font-size: 10px;">${noteHtml}</td>
          `;
          tbody.appendChild(tr);

          // ç…§ç‰‡è™•ç†
          const allImages = [
            ...(pkg.productImages || []),
            ...(pkg.warehouseImages || []),
          ];
          if (Array.isArray(allImages)) {
            allImages.forEach((imgUrl) => {
              const div = document.createElement("div");
              div.className = "photo-wrapper";
              div.innerHTML = `<img src="${API_BASE_URL}${imgUrl}" alt="photo"><div class="photo-caption">${pkg.productName}</div>`;
              photosGrid.appendChild(div);
            });
          }
        });

        // --- çµ±è¨ˆæ•¸æ“šæ›´æ–° ---
        document.getElementById("p-total-qty").textContent = totalQty;
        document.getElementById("p-total-boxes").textContent = grandTotalBoxes; // æ–°å¢ç®±æ•¸çµ±è¨ˆ
        document.getElementById("p-total-weight").textContent =
          grandTotalWeight.toFixed(1) + " kg";
        document.getElementById("p-total-cai").textContent =
          grandTotalCai.toFixed(2) + " æ"; // æ–°å¢æç©çµ±è¨ˆ
        document.getElementById("p-total-cost").textContent = `NT$ ${(
          ship.totalCost || 0
        ).toLocaleString()}`;

        if (photosGrid.children.length === 0) {
          document.getElementById("photo-section").style.display = "none";
        }
      }
    </script>
  </body>
</html>
